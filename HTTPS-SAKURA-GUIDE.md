# 动漫角色猜谜游戏 - 樱花内网穿透HTTPS指南

本指南将帮助你使用樱花（SakuraFrp）内网穿透服务的HTTPS模式来部署动漫角色猜谜游戏，解决"501 Not Implemented"错误。

## 501 错误说明

当你看到以下错误信息时：

```
501 Not Implemented
#216
您正试图使用 HTTP 协议访问此隧道

因为下面的原因，此请求已被拦截:
- 执行机房的内容合规要求和有关部门的管控规定
- 限制施行实名认证仍无法遏止的滥用行为
```

这表明樱花内网穿透服务要求使用HTTPS协议来访问你的应用程序。我们已经更新了`start-sakura.bat`脚本，使其支持HTTPS。

## 准备工作

1. **确保已完成基本设置**
   - 已注册并下载樱花内网穿透客户端
   - 已购买节点并有足够的流量

2. **更新本地代码**
   - 确保你已获取最新版本的游戏代码，包含HTTPS支持

## 樱花HTTPS穿透配置步骤

### 1. 在樱花面板创建HTTPS隧道

你需要创建两个HTTPS隧道：

#### 前端隧道:
- 隧道类型: **HTTPS**（不是HTTP）
- 本地IP: 127.0.0.1
- 本地端口: 5173
- 远程端口: 自定义（记住这个端口号）
- 节点: 选择离你较近的节点
- **启用SSL**: 勾选此选项
- **证书类型**: 选择"使用SakuraFrp提供的SSL证书"

#### 后端隧道:
- 隧道类型: **HTTPS**（不是TCP）
- 本地IP: 127.0.0.1
- 本地端口: 3000
- 远程端口: 自定义（记住这个端口号）
- 节点: 与前端隧道相同的节点
- **启用SSL**: 勾选此选项
- **证书类型**: 选择"使用SakuraFrp提供的SSL证书"

### 2. 启动隧道

1. 在樱花内网穿透客户端中启动你创建的两个隧道
2. 确保状态显示为"已连接"

### 3. 使用start-sakura.bat启动游戏

1. 运行`start-sakura.bat`脚本
2. 输入樱花分配的域名（不含http://或https://）
   例如: `xxxx.natfrp.cloud`
3. 输入前端穿透端口（你在前端隧道中设置的远程端口）
4. 输入后端穿透端口（你在后端隧道中设置的远程端口）
5. 确认信息并等待服务启动

脚本将自动：
- 生成自签名SSL证书（仅用于本地开发）
- 配置客户端和服务器使用HTTPS
- 启动所有必要的服务

## 访问游戏

服务启动后，你和你的朋友可以通过以下地址访问游戏：

```
https://你的樱花域名:前端穿透端口
```

例如:
```
https://xxxx.natfrp.cloud:12345
```

## 常见问题

### 1. 证书警告

当访问你的游戏时，浏览器可能会显示证书警告。这是因为：
- 本地使用了自签名证书
- 樱花提供的证书可能不被某些浏览器完全信任

解决方法：
- 点击"高级"然后"继续访问"（不同浏览器提示可能不同）
- 这不会影响游戏功能，只是浏览器的一个安全提示

### 2. WebSocket连接问题

如果游戏中的WebSocket无法连接：
- 确保两个隧道都使用HTTPS（不是HTTP和TCP的组合）
- 确保樱花客户端中启用了"WebSocket支持"选项
- 检查前端和后端端口是否正确配置

### 3. 其他模式不受影响

本更新不会影响其他启动方式：
- `start-lan-simple.bat`仍然可以正常用于局域网游戏
- 其他启动脚本也不受影响

## 注意事项

- HTTPS证书由樱花提供，你不需要自己购买证书
- 自签名证书仅用于本地开发，实际穿透时使用樱花的证书
- 樱花内网穿透是付费服务，使用可能产生流量费用
- 公网部署有安全风险，请勿长时间部署 